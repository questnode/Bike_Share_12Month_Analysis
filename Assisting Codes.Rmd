---
title: "Assisting Codes"
output: html_document
date: "2022-12-24"
---
## Remove column from dataset using subset

```{r}


merged_trips <- subset(merged_trips, select = -c(old_end_station_name))

```


## Create a test dataset

```{r}
tester <- merged_trips[merged_trips$start_lat == "",]
tester <- merged_trips[is.na(merged_trips$end_lat),]

tester <- merged_trips[((merged_trips$start_station_id == "" & merged_trips$start_station_name != "") | (merged_trips$start_station_id != "" & merged_trips$start_station_name == "")),]
tester <- merged_trips[((merged_trips$end_station_id == "")),]
tester2 <- tester[((tester$end_station_name != "")),]
tester <- trips2[(!is.na(trips2$name)), ]
tester0 <- merged_trips[(merged_trips$old_start_station_id != "" & merged_trips$new_start_station_id != "") & 
                          (merged_trips$old_start_station_id != merged_trips$new_start_station_id),]


tester0_0 <- merged_trips[merged_trips$start_station_id == "TA1306000029", ]
tester0_1 <- merged_trips[(merged_trips$old_end_station_name != merged_trips$new_end_station_id) ,]
tester1 <- merged_trips[(merged_trips$start_station_id == "731" | merged_trips$end_station_id == "731") ,]
tester2 <- merged_trips_original[(merged_trips_original$start_station_id == "731" | merged_trips_original$end_station_id == "731") ,]
tester3 <- work_list[(work_list$id == "731") ,]
tester4 <- correction_list[(correction_list$id == "15541" | correction_list$Freq == "163" | correction_list$name == "163") ,]
tester4_1 <- holding_list_name_id[!is.na(holding_list_name_id$name),]
tester5 <- holding_list_name_id[(holding_list_name_id$id == "163" | holding_list_name_id$name == "163"),]
```

## Merge column using ifelse
```{r}
merged_trips$start_station_id_copy <- ifelse(!merged_trips$start_station_id_copy == "", merged_trips$start_station_id_copy, start_station_ids_found)
merged_trips$start_station_name_copy <- ifelse(!merged_trips$start_station_name_copy == "", merged_trips$start_station_name_copy, start_station_names_found)
```


## Add a column using another vector

```{r}
merged_trips$start_station_id_copy <- merged_trips$start_station_id
merged_trips$start_station_name_copy <- merged_trips$start_station_name
```


```{r}

for (i in seq_along(lengths(start_station_usage$station_name))) {print(start_station_usage$usage[i])}
```

```{r}
for (i in 1:10) {
  print(start_station_usage$name[i])
  test <- sort(merged_trips %>% filter(start_station_name == start_station_usage$station_name[i]), decreasing=T)[1:10]
}

test <- data.frame(sort(table((merged_trips %>% filter(start_station_name == start_station_usage$station_name[1]))$end_station_name),decreasing=T))[1:10,] %>% 'colnames<-' (c('station','usage'))

colnames(test) <-c('station','usage')
```

```{r}
 #start_station_usage %>% 
 data.frame(sort(table((merged_trips %>% filter(start_station_name == start_station_usage$station_name[1]))$end_station_name),decreasing=T))[1:10,] %>% 'colnames<-' (c('station','usage')) %>% 
    arrange(desc(usage)) %>%
    slice(1:5) %>%
    ggplot(., aes(x=station,y=usage))+
              geom_bar(stat='identity')
```

```{r}
top_n(merged_trips, n=3, freq) %>%
          ggplot(., aes(x=type, y=freq))+
              geom_bar(stat='identity')
```

```{r}
test <- top_n(merged_trips, n=3, start_station_name)
```

Figuring exactly how many unique stations there are
```{r}

u_start_name <- data.frame(unique(merged_trips$start_station_name)) %>% 'colnames<-' (c('name'))
u_start_id <- data.frame(unique(merged_trips$start_station_id)) %>% 'colnames<-' (c('id'))

u_end_name <- data.frame(unique(merged_trips$end_station_name)) %>% 'colnames<-' (c('name'))
u_end_id <- data.frame(unique(merged_trips$end_station_id)) %>% 'colnames<-' (c('id'))

all_names <- rbind(u_start_name, u_end_name)
all_ids <- rbind(u_start_id, u_end_id)

u_names <- unique(all_names)
u_ids <- unique(all_ids)

u_stations <- unique(
  rbind(
    (data.frame(unique(merged_trips$start_station_name)) %>% 'colnames<-' (c('name'))),
    (data.frame(unique(merged_trips$end_station_name)) %>% 'colnames<-' (c('name')))
))

all_stations <- rbind(
  (data.frame((merged_trips$start_station_name)) %>% 'colnames<-' (c('name'))),
  (data.frame((merged_trips$end_station_name)) %>% 'colnames<-' (c('name')))
)


```


```{r}
duplicated_rides <- merged_trips[duplicated(merged_trips[,c('ride_id')]),]

non_duplicated_rides <- merged_trips[!duplicated(merged_trips[,c('ride_id')]),]

#dat[duplicated(dat[,1:2]),]
#dat[!duplicated(dat[,c('id','id2')]),]
```

## Unify Station Names
Multiple version of name exist for some station.  Unification should be done so that each staion is only referred to by one name.

```{r}
# Start by compiling a list of unique station names along with their station ID

station_names <- data.frame(sort(unique(unique(merged_trips$end_station_name),unique(merged_trips$start_station_name))))
colnames(station_names) <- c('name')


stations_raw <- merged_trips[,c('start_station_id', 'start_station_name')]
colnames(stations_raw) <- c('id','name')
stations_raw2 <- merged_trips[,c('end_station_id', 'end_station_name')]
colnames(stations_raw2) <- c('id','name')
stations_raw <- rbind(stations_raw, stations_raw2)

station_match = data.frame(name=station_names$name, id=stations_raw[match(station_names$name, stations_raw$name), 1])
station_match <- (station_match %>% relocate(id))
station_match <- station_match[order(station_match$name),]

match_names <- data.frame(unique(station_match$name))
colnames(match_names) <- c('name')
# data.frame(v1=d$v1, v4=m[match(d$v2, m$v3), 2])
```

Try a second way to obtain a list of all unique station names (with duplicate station IDs)

```{r}

stations_raw3 <- rbind((merged_trips[,c('start_station_id', 'start_station_name')] %>% 'colnames<-' (c('id','name'))), (merged_trips[,c('end_station_id', 'end_station_name')] %>% 'colnames<-' (c('id','name'))))
station_match2 = stations_raw3[!duplicated(stations_raw3[,c('name')]),]

station_match2 %>% relocate(id)
station_match2 <- station_match2[order(station_match2$name),]

match2_names <- data.frame(unique(station_match2$name))
colnames(match2_names) <- c('name')

#dat[!duplicated(dat[,c('id','id2')]),]

```

Find out why the two methods are different

```{r}
match_diff <- anti_join(match2_names, match_names)
match_diff <- setdiff(match2_names, match_names)
```

